# Жодних горутин у `init()`

Функції `init()` не повинні створювати горутини.
Також зверніть увагу на [уникайте init()](init.md).

Якщо пакету потрібна фонова горутина, він повинен створити об'єкт, який відповідає за керування часом її роботи.
Об'єкт повинен надавати метод (`Close`, `Stop`, `Shutdown` тощо), який сигналізує про зупинку фонової горутини та чекає на її завершення.

<table>
<thead><tr><th>Не рекомендовано</th><th>Рекомендовано</th></tr></thead>
<tbody>
<tr><td>

```go
func init() {
  go doWork()
}

func doWork() {
  for {
    // ...
  }
}
```

</td><td>

```go
type Worker struct{ /* ... */ }

func NewWorker(...) *Worker {
  w := &Worker{
    stop: make(chan struct{}),
    done: make(chan struct{}),
    // ...
  }
  go w.doWork()
}

func (w *Worker) doWork() {
  defer close(w.done)
  for {
    // ...
    case <-w.stop:
      return
  }
}

// Shutdown повідомляє worker про зупинку
// та чекає, поки він не закінчить роботу.

func (w *Worker) Shutdown() {
  close(w.stop)
  <-w.done
}
```

</td></tr>
<tr><td>

Безпосередньо запускає фонову горутину, коли користувач експортує цей пакет. Користувач не має жодного контролю над горутиною та не може її зупинити.

</td><td>

Створює *worker* лише за запитом користувача. Надає можливість закрити *worker*, щоб користувач міг звільнити ресурси, які використовуються.

Зауважте, що вам слід використовувати `WaitGroup`, якщо *worker* керує декількома горутинами.
Див. [очікуйте завершення горутин](goroutine-exit.md).

</td></tr>
</tbody></table>
