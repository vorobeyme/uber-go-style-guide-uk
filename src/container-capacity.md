# Намагайтесь вказувати місткість контейнера

Де це можливо, вказуйте місткість (capacity) контейнера, щоб наперед виділити відповідний обсяг пам'яті.
Це мінімізує подальші виділення пам'яті (allocations) у міру додавання нових елементів
(шляхом копіювання та зміни розміру контейнера).

## Вказуйте місткість для карт

Якщо це можливо, вкажіть місткість під час ініціалізації карт за допомогою `make()`.

```go
make(map[T1]T2, hint)
```

Задання місткості під час виклику `make()` намагається підібрати правильний розмір карти
під час її ініціалізації, що зменшує кількість операцій виділення пам'яті під час
додання нових елементів до карти.

Пам'ятайте, що, на відміну від зрізів, місткість для карт не гарантує
повного та остаточного виділення пам'яті, а використовується для приблизної кількості
необхідних сегментів хеш-карти.
Отже, виділення додаткової пам'яті все одно можуть відбуватися під час додавання
елементів до карти, навіть до вказаної наперед місткості.

<table>
<thead><tr><th>Не рекомендовано</th><th>Рекомендовано</th></tr></thead>
<tbody>
<tr><td>

```go
m := make(map[string]os.FileInfo)

files, _ := os.ReadDir("./files")
for _, f := range files {
    m[f.Name()] = f
}
```

</td><td>

```go

files, _ := os.ReadDir("./files")

m := make(map[string]os.DirEntry, len(files))
for _, f := range files {
    m[f.Name()] = f
}
```

</td></tr>
<tr><td>

`m` створюється без вказування розміру; може бути більше розподілів під час призначення.

</td><td>

`m` створюється із вказуванням розміру; може бути менше розподілів під час призначення.

</td></tr>
</tbody></table>

## Вказуйте місткість для зрізів

Якщо це можливо, вказуйте місткість зрізів під час ініціалізації за допомогою `make()`,
особливо при додаванні.

```go
make([]T, length, capacity)
```

На відміну від карт, для місткості зрізів компілятор виділить достатньо
пам'яті, скільки було вказано в `make()`. Це означає, що всі наступні операції `append()`
не вимагатимуть виділення додаткової пам'яті (допоки довжина зрізу відповідає місткості,
після чого будь-які додавання вимагатимуть зміни розміру, для додавання нових елементів).

<table>
<thead><tr><th>Не рекомендовано</th><th>Рекомендовано</th></tr></thead>
<tbody>
<tr><td>

```go
for n := 0; n < b.N; n++ {
  data := make([]int, 0)
  for k := 0; k < size; k++{
    data = append(data, k)
  }
}
```

</td><td>

```go
for n := 0; n < b.N; n++ {
  data := make([]int, 0, size)
  for k := 0; k < size; k++{
    data = append(data, k)
  }
}
```

</td></tr>
<tr><td>

```plain
BenchmarkBad-4    100000000    2.48s
```

</td><td>

```plain
BenchmarkGood-4   100000000    0.21s
```

</td></tr>
</tbody></table>
